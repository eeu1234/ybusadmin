<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="busCategoryManage">

	<!-- 버스정보가 SHOW인 것 대학SEQ참조하여 가져오기 -->
	<select id="getShowBusInfo" parameterType="String" resultType="com.test.spring.dto.BusCategoryInfoDTO">
		<!-- SELECT BUSINFOSEQ AS busInfoSeq, BUSINFONUM AS busInfoNum,
		BUSINFONAME AS busInfoName, BUSINFOSTAT AS busInfoStat, 
		IFNULL(BI.BUSSTOPCATEGORYSEQ,'미배정') AS busStopCategorySeq, IFNULL(BI.BUSSTOPDETAILCATEGORYSEQ,'미배정') AS busStopDetailCategorySeq,
		IFNULL(BC.BUSSTOPCATEGORY,'미배정') AS busStopCategory, IFNULL(BDC.BUSSTOPDETAILCATEGORYNAME,'미배정') AS busStopDetailCategoryName
		FROM BUS_INFO BI
		INNER JOIN DEVICE D
		ON D.DEVICESEQ = BI.DEVICESEQ
		INNER JOIN UNIVERSITY U
		ON U.UNIVERSITYSEQ = D.UNIVERSITYSEQ
		LEFT JOIN BUSSTOP_CATEGORY BC
		ON BC.BUSSTOPCATEGORYSEQ = BI.BUSSTOPCATEGORYSEQ
		LEFT JOIN BUSSTOP_DETAIL_CATEGORY BDC
		ON BDC.BUSSTOPDETAILCATEGORYSEQ = BI.BUSSTOPDETAILCATEGORYSEQ
		WHERE BI.BUSINFOSTAT = 'show' AND U.UNIVERSITYSEQ = #{seq}; -->
		SELECT BI.BUSINFOSEQ AS busInfoSeq, BI.BUSINFONUM AS busInfoNum,
		BI.BUSINFONAME AS busInfoName, BI.BUSINFOSTAT AS busInfoStat, 
		IFNULL(BI.BUSSTOPCATEGORYSEQ,'미배정') AS busStopCategorySeq, IFNULL(BI.BUSSTOPDETAILCATEGORYSEQ,'미배정') AS busStopDetailCategorySeq,
		IFNULL(BC.BUSSTOPCATEGORY,'미배정') AS busStopCategory, IFNULL(BDC.BUSSTOPDETAILCATEGORYNAME,'미배정') AS busStopDetailCategoryName,
        U.UNIVERSITYSEQ AS universitySeq, DB.DEVICESEQ AS deviceSeq, DB.DEVICEBUSSTAT AS deviceBusStat
        FROM BUS_INFO BI
        INNER JOIN DEVICE_BUS DB
        ON DB.BUSINFOSEQ = BI.BUSINFOSEQ
		LEFT JOIN BUSSTOP_CATEGORY BC
		ON BC.BUSSTOPCATEGORYSEQ = BI.BUSSTOPCATEGORYSEQ
        INNER JOIN UNIVERSITY U
		ON U.UNIVERSITYSEQ = BC.UNIVERSITYSEQ
        LEFT JOIN BUSSTOP_DETAIL_CATEGORY BDC
		ON BDC.BUSSTOPDETAILCATEGORYSEQ = BI.BUSSTOPDETAILCATEGORYSEQ
        WHERE DB.DEVICEBUSSTAT = 'show' AND U.UNIVERSITYSEQ = #{seq}
	</select>   


	<!-- 버스 대분류 리스트가져오기 대학seq참조 -->
	<select id="busStopCategory" parameterType="String" resultType="com.test.spring.dto.BusStopCategoryDTO">
		SELECT BUSSTOPCATEGORYSEQ AS busStopCategorySeq, BUSSTOPCATEGORY AS busStopCategory, BUSSTOPCATEGORYSTAT AS busStopCategoryStat,
		UNIVERSITYSEQ AS universitySeq, GROUPBUSHASH AS groupbusHashkey
		FROM BUSSTOP_CATEGORY
		WHERE UNIVERSITYSEQ = #{seq} AND BUSSTOPCATEGORYSTAT = 'show';
	</select>
	
	<!-- 중분류 리스트 가져오기 대분류 seq참조 show인상태만 -->
   	<select id="getDetailCategory" parameterType="String" resultType="com.test.spring.dto.BusStopDetailCategoryDTO">
   		SELECT BUSSTOPDETAILCATEGORYSEQ AS BusStopDetailCategorySeq, BUSSTOPDETAILCATEGORYNAME AS BusStopDetailCategoryName FROM BUSSTOP_DETAIL_CATEGORY
            WHERE BUSSTOPCATEGORYSEQ = #{seq} AND BUSSTOPDETAILCATEGORYSTAT = 'show';
   	</select>
   
   <!-- 버스 하나의 정보만가져오기 -->
   <select id="getBusInfo" parameterType="String" resultType="com.test.spring.dto.BusCategoryInfoDTO">
   		<!-- SELECT BUSINFOSEQ AS busInfoSeq, BUSINFONUM AS busInfoNum,
		BUSINFONAME AS busInfoName, BUSINFOSTAT AS busInfoStat, 
		IFNULL(BI.BUSSTOPCATEGORYSEQ,'미배정') AS busStopCategorySeq, IFNULL(BI.BUSSTOPDETAILCATEGORYSEQ,'미배정') AS busStopDetailCategorySeq,
		IFNULL(BC.BUSSTOPCATEGORY,'미배정') AS busStopCategory, IFNULL(BDC.BUSSTOPDETAILCATEGORYNAME,'미배정') AS busStopDetailCategoryName
		FROM BUS_INFO BI
		INNER JOIN DEVICE D
		ON D.DEVICESEQ = BI.DEVICESEQ
		INNER JOIN UNIVERSITY U
		ON U.UNIVERSITYSEQ = D.UNIVERSITYSEQ
		LEFT JOIN BUSSTOP_CATEGORY BC
		ON BC.BUSSTOPCATEGORYSEQ = BI.BUSSTOPCATEGORYSEQ
		LEFT JOIN BUSSTOP_DETAIL_CATEGORY BDC
		ON BDC.BUSSTOPDETAILCATEGORYSEQ = BI.BUSSTOPDETAILCATEGORYSEQ
		WHERE BUSINFOSEQ = #{seq}; -->
		SELECT BI.BUSINFOSEQ AS busInfoSeq, BI.BUSINFONUM AS busInfoNum,
		BI.BUSINFONAME AS busInfoName, BI.BUSINFOSTAT AS busInfoStat, 
		IFNULL(BI.BUSSTOPCATEGORYSEQ,'미배정') AS busStopCategorySeq, IFNULL(BI.BUSSTOPDETAILCATEGORYSEQ,'미배정') AS busStopDetailCategorySeq,
		IFNULL(BC.BUSSTOPCATEGORY,'미배정') AS busStopCategory, IFNULL(BDC.BUSSTOPDETAILCATEGORYNAME,'미배정') AS busStopDetailCategoryName,
        U.UNIVERSITYSEQ AS universitySeq, DB.DEVICESEQ AS deviceSeq, DB.DEVICEBUSSTAT AS deviceBusStat
        FROM BUS_INFO BI
        INNER JOIN DEVICE_BUS DB
        ON DB.BUSINFOSEQ = BI.BUSINFOSEQ
		LEFT JOIN BUSSTOP_CATEGORY BC
		ON BC.BUSSTOPCATEGORYSEQ = BI.BUSSTOPCATEGORYSEQ
        INNER JOIN UNIVERSITY U
		ON U.UNIVERSITYSEQ = BC.UNIVERSITYSEQ
        LEFT JOIN BUSSTOP_DETAIL_CATEGORY BDC
		ON BDC.BUSSTOPDETAILCATEGORYSEQ = BI.BUSSTOPDETAILCATEGORYSEQ
        WHERE BI.BUSINFOSEQ = #{seq} AND DB.DEVICEBUSSTAT = 'show'
   </select>
   
   <!-- 대분류,중분류 가지고 버스인포 테이블 수정하기 -->
   <update id="updateBusCategory" parameterType="map">
   		UPDATE BUS_INFO SET BUSSTOPCATEGORYSEQ = ${busCategorySel} , BUSSTOPDETAILCATEGORYSEQ = ${busDetailCategorySel} WHERE BUSINFOSEQ = #{seq};
   </update>
</mapper>








